---
description: Standards for financial analysis queries and success metrics
globs: ["**/*.sql", "dbt/models/**/*.sql", "src/analysis/**/*.py"]
alwaysApply: false
---

# Financial Analysis Standards

## Core Capabilities

System must answer key financial questions:

- "How much did I pay in taxes last year?"
- "What did I spend last year by category?"
- "What was my total income from all sources?"
- "How has my spending changed over time?"

## Performance Requirements

- Query response < 5 seconds
- Handle growing data volumes efficiently
- Consistent, accurate results

## Common Patterns

```sql
-- Tax payments by year
SELECT strftime('%Y', date) as year, SUM(amount) as total_taxes
FROM transactions
WHERE category IN ('Federal Tax', 'State Tax')
GROUP BY year ORDER BY year DESC;

-- Annual spending by category
SELECT strftime('%Y', date) as year, category, SUM(ABS(amount)) as total
FROM transactions
WHERE amount < 0  -- Expenses are negative
GROUP BY year, category ORDER BY year DESC, total DESC;

-- Monthly trends
SELECT strftime('%Y-%m', date) as month, SUM(ABS(amount)) as spending
FROM transactions
WHERE amount < 0
GROUP BY month ORDER BY month;
```

## Best Practices

- Validate date ranges in queries
- Handle edge cases (refunds, transfers, corrections)
- Use appropriate indexes for common patterns
- Format financial amounts consistently
